{
    "contents" : "#\n# This is a Shiny web application. You can run the application by clicking\n# the 'Run App' button above.\n#\n# Find out more about building applications with Shiny here:\n#\n#    http://shiny.rstudio.com/\n#\n\nlibrary(shinydashboard)\nlibrary(rgdal)\nlibrary(leaflet)\nlibrary(dplyr)\nlibrary(DT)\n#load data\ncrime_data <- readRDS(\"../data/database.rds\")\n\ncrime_data <- crime_data %>%\n    mutate(Solved = ifelse(Crime.Solved == \"Yes\", 1, 0)) %>%\n    filter(Crime.Type == \"Murder or Manslaughter\")\n\nstates <- readOGR(\"../data/cb_2016_us_state_500k/cb_2016_us_state_500k.shp\")\n#line up the states between our data and the shapefile\nis.element(crime_data$State, states$NAME)\n\n#rename Rhodes Island\nlevels(crime_data$State)[40] <- \"Rhode Island\"\n\n#should now be all true\nis.element(crime_data$State, states$NAME)\n\n#now check that all shapefile states are in us data\nis.element(states$NAME, crime_data$State)\n\n#we see that we're missing the following: 33, 34, 54, 55, 56\nmissing_states <- states$NAME[c(33, 34, 54, 55, 56)]\n\nstates <- subset(states, is.element(states$NAME, crime_data$State))\n\nbins <- c(0.30, 0.40,0.50,0.60,0.70,0.80,0.90, 1.0)\npal <- colorBin(\"RdYlBu\", domain = c(0,1), bins = bins)\n\nui <- dashboardPage(\n    skin = \"red\",\n    dashboardHeader(title = \"Homicide Dashboard\"),\n    dashboardSidebar(\n        sliderInput(\"date_range\", \"Date Range:\", \n                    min = min(crime_data$Year), \n                    max = max(crime_data$Year), \n                    value = c(min(crime_data$Year),max(crime_data$Year)), \n                    sep = \"\",\n                    step = 1\n        )\n    ),\n    dashboardBody(\n        fluidRow( box(width = 12,\n                      leafletOutput(\"mymap\")\n        )),\n        fluidRow( box(width = 12,\n                      dataTableOutput(\"summary_table\")))\n    )\n)\n\nserver <- function(input, output) {\n    \n    data_input <- reactive({\n        crime_data %>%\n            filter(Year >= input$date_range[1]) %>%\n            filter(Year <= input$date_range[2]) %>%\n            group_by(State) %>%\n            summarise(Num.Murders = n(),\n                      Num.Solved = sum(Solved)) %>%\n            mutate(Num.Unsolved = Num.Murders - Num.Solved,\n                   Solve.Rate = Num.Solved/Num.Murders)\n    })\n    \n    data_input_ordered <- reactive({\n        data_input()[order(match(data_input()$State, states$NAME)),]\n    })\n    \n    labels <- reactive({\n        paste(\"<p>\", data_input_ordered()$State, \"</p>\",\n              \"<p>\", \"Solve Rate: \", round(data_input_ordered()$Solve.Rate, digits = 3), \"</p>\",\n              sep=\"\")\n    })\n    \n    # leaflet_map <- reactive({\n    #   leaflet() %>%\n    #     setView(-96, 37.8, 4) %>%\n    #     addProviderTiles(providers$Stamen.Toner) \n    # })\n    \n    output$mymap <- renderLeaflet({\n        leaflet() %>%\n            setView(-96, 37.8, 4) %>%\n            addProviderTiles(providers$Stamen.Toner) %>%\n            addPolygons(data = states,\n                        fillColor = pal(data_input_ordered()$Solve.Rate),\n                        weight = 1,\n                        smoothFactor = 0.5,\n                        color = \"white\",\n                        fillOpacity = 0.8,\n                        highlight = highlightOptions(\n                            weight = 5,\n                            color = \"#666\",\n                            dashArray = \"\",\n                            fillOpacity = 0.7,\n                            bringToFront = TRUE),\n                        label = lapply(labels(), HTML)) %>%\n            addLegend(pal = pal,\n                      values = data_input_ordered()$Solve.Rate,\n                      opacity = 0.7,\n                      title = NULL,\n                      position = \"topright\")\n        \n    })\n    \n    output$summary_table = DT::renderDataTable(\n        data_input(), options = list(lengthChange = FALSE)\n    )\n    \n    \n}\n\nshinyApp(ui, server)",
    "created" : 1521703006273.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "391735221",
    "id" : "620F04D3",
    "lastKnownWriteTime" : 1521702985,
    "path" : "~/Documents/little red laptop/rscripts/wdc-leaflet/dash/dash.R",
    "project_path" : "dash/dash.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}